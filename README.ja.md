[中文(中国)](README.md) [English](README.en.md)
[English](README.en.md) [日本語](README.ja.md)

# BiliBili コメント/動画ダウンロードソフトウェア
- [BiliBili コメント/動画ダウンロードソフトウェア](#BiliBili コメント/動画ダウンロードソフトウェア)
    * [紹介](#紹介)
    * [プログラム機能](#プログラム機能)
    * [依存ライブラリ](#依存ライブラリ)
        + [JavaScript依存ライブラリ](#javascript依存ライブラリ)
    * [ファイル構成](#ファイル構成)
        + [cookies.json](#cookiesjson)
        + [settings.json](#settingsjson)
        + [webui.json](#webuijson)
        + [sections.json](#sectionsjson)
        + [tv.bilibili.player.xml](#tvbilibiliplayerxml)
    * [はじめに](#はじめに)
        + [prepare.py](#preparepy)
        + [コメントのフィルタリング](#コメントのフィルタリング)
    * [翻訳](#翻訳)
    * [その他](#その他)
        + [全コメントのダウンロード問題](#全コメントのダウンロード問題)
    * [FAQ](#faq)
        + [リリースにおける各ドキュメントの違い](#リリースにおける各ドキュメントの違い)
        + [パスワードを入力できない](#パスワードを入力できない)
        + [大会員のアカウントは、大会員しか見られないことを示唆している](#大会員のアカウントは、大会員しか見られないことを示唆している)
        + [デフォルトのダウンロード場所はどこですか？](#デフォルトのダウンロード場所はどこですか？)
        + [ffmpeg, aria2cを使用するべきかどうか](#ffmpeg, aria2cを使用するべきかどうか)
        + [一括ダウンロードする方法](#一括ダウンロードする方法)
        + [クラッシュした場合の対処方法](#クラッシュした場合の対処方法)
        + [aria2cのいくつかのダウンロード設定は何を意味しますか？](#aria2cのいくつかのダウンロード設定は何を意味しますか？)
## 紹介
このプログラムはPython(Python 3.x)言語で書かれており、いくつかのPythonライラリとChromeDriverを使用しています(ChromeDriverを持っているとログインやキャプチャ認証が簡単になります。またメインプログラムには影響しません)。
コマンドライン(Command Line)に対応  
リリース ビルドスクリプトは[bili.build.bat](https://github.com/lifegpc/bili.build.bat)にあります。
## プログラム機能
- [x] [aria2cを使用したダウンロード](#aria2cを使用したダウンロード)
- [x] [分割された動画の自動マージ](#分割された動画の自動マージ)
- [x] [mp4およびmkv形式](#mp4およびmkv形式)
- [x] [m4a形式](#m4a形式)
- [x] [flac形式](#flac形式)
- [ ] [mp3形式](#mp3形式)
- [x] [一般No.AV/BV](#一般No.AV/BV)
    * [x] コメントダウンロード
    * [x] 全コメント(コメント履歴)ダウンロード
    * [x] ビデオダウンロード
    * [x] [オーディオのみダウンロード](#オーディオのみダウンロード)
    * [x] カバーイメージ(サムネイル)のみダウンロード
    * [x] 字幕のみダウンロード
    * [x] 4KとHDR
    * [x] インタラクティブなビデオ
- [x] [番組](#番組)
    * [x] コメントダウンロード
    * [x] 全コメント(コメント履歴)ダウンロード
    * [x] ビデオダウンロード
    * [x] [オーディオのみダウンロード](#オーディオのみダウンロード-1)
    * [x] [カバーイメージ(サムネイル)のみダウンロード](#カバーイメージ(サムネイル)のみダウンロード)
    * [x] 4K
    * [ ] HDR(サポート可能、現時点でのテスト可能な動画はありません)
- [x] [有料コンテンツ](#有料コンテンツ)
    * 与[番組](#番組)とほぼ同じ
    * [カバーイメージ(サムネイル)のみダウンロード](#カバーイメージ(サムネイル)のみダウンロード-1)
- [x] [有料コンテンツ一覧](#有料コンテンツ一覧)
- [x] [お気に入り](#お気に入り)
    * [サポートしているGETパラメーター](#サポートしているGETパラメーター)
- [x] [チャンネル一覧](#チャンネル一覧)
- [x] [チャンネル](#チャンネル)
    * [サポートしているGETパラメーター](#サポートしているGETパラメーター-1)
- [x] [投稿動画一覧](#投稿動画一覧)
    * [サポートしているGETパラメーター](#サポートしているGETパラメーター-2)
- [x] [ライブ映像](#ライブ映像)
    * [x] [ビデオダウンロード](#ビデオダウンロード)
    * [x] [コメントダウンロード](#コメントダウンロード)
- [x] [ライブストリーミング](#ライブストリーミング)
    * [x] [ビデオダウンロード](#ビデオダウンロード-1)
- [x] [No.AUオーディオ](#No.AUオーディオ)
    * [x] [オーディオダウンロード](#オーディオダウンロード)
    * [x] [歌詞のみダウンロード](#歌詞のみダウンロード)
    * [x] カバーイメージ(サムネイル)のみダウンロード
- [x] [プレイリスト](#プレイリスト)
### aria2cを使用したダウンロード
このプログラムはaria2cを使用してのダウンロードをサポートしており、より良いダウンロード体験のためにaria2cを使用することをお勧めします。
この機能を有効にするには、コマンドライン(通常はプログラムディレクトリから直接aria2cを呼び出すことが可能)から設定でaria2cの使用を有効にしていることを確認する必要があります。
### 分割された動画の自動マージ
このプログラムは分割されたビデオを自動マージするためにffmpegを使用しています。
この機能を有効にするには、コマンドラインから直接ffmpegを呼び出せるようにする必要があります(一般的にはプログラムディレクトリに置くだけ)、設定でffmpegが無効になっていないことを確認する必要があります。
### mp4およびmkv形式
このプログラムは、mp4ファイルまたはmkvファイルへの結合をサポートし、設定でビデオフォーマットを選択することができます。
### m4a形式
このプログラムは、m4aファイルとしてオーディオファイルの直接ダウンロードをサポートしています。
### flac形式
音声の一部にはロスレスの音質が含まれており、flacファイルとして保存することができます。
### mp3形式
このプログラムは現在、mp3形式をサポートしていません（トランスコードしたくないから）
### 一般No.AV/BVビデオ
このプログラムでは、以下の入力に対応しています（例としてAV9、大文字小文字は無視）：
- ```9```
- ```av9```
- ```BV1xx411c7mC```
- ```bilibili.com/video/av9``` （URLのhttps:\\, wwwとかは入力しなくても大丈夫）
- ```bilibili.com/video/BV1xx411c7mC```
- ```b23.tv/av9```
- ```b23.tv/BV1xx411c7mC```
- ```bilibili.com/s/video/av9```
- ```bilibili.com/s/video/BV1xx411c7mC```

動画が[番組](#番組)を指しているのであれば、自動的に番組にリダイレクトされます。
#### オーディオのみダウンロード
現在、DASHストリームの解析結果のみがサポートされています（現時点ではDASHではない解析結果はほとんどありません）
### 番組
このプログラムでは、以下の入力をサポートしています（例としてSS26291、大文字小文字は無視）：
- ```ss26291```
- ```ep259653```
- ```md4316442```
- ```bilibili.com/bangumi/play/ss26291```
- ```bilibili.com/bangumi/play/ep259653```
- ```bilibili.com/bangumi/media/md4316442```
- ```b23.tv/ss26291```
- ```b23.tv/ep259653```
- ```40240711```などNo.AV/BVビデオ

既存のSS番号またはEP番号に基づいてコンテンツが見つからない場合は、同じSS番号およびEP番号を使用して[有料コンテンツ](#有料コンテンツ)へのアクセスを試みます。
#### オーディオのみダウンロード
現在、DASHストリームの解析結果のみがサポートされています
#### カバーイメージ(サムネイル)のみダウンロード
現在開催中のセッションの表紙をダウンロードすると、番組全体のカバーイメージ(サムネイル)が自動的にダウンロードされます。
### 有料コンテンツ
このプログラムでは、以下の入力に対応しています(例としてSS150、大文字小文字は無視)：
- ```bilibili.com/cheese/play/ss150```
- ```bilibili.com/cheese/play/ep2425```
#### カバーイメージ(サムネイル)のみダウンロード
現在のセッションの表紙ではなく、全講座の表紙だけでなく、紹介画像もダウンロードされます。
### 有料コンテンツ一覧
このプログラムは以下の入力をサポートしています：
- ```bilibili.com/cheese/mine/list```
- ```bilibili.com/v/cheese/mine/list```

購入したすべてのコースは、ダウンロードする必要があるものを選択するために解析されます。
### お気に入り
このプログラムは以下の入力をサポートしています(UID1を例にしています)：
- ```space.bilibili.com/1/favlist```

会将所有收藏夹内的视频解析出来以供选择需要下载的视频。
#### サポートしているGETパラメーター
- ```fid```：どのお気に入りかを指定するために使用します
- ```keyword```：お気に入り検索に使用
- ```type```：すべてのお気に入りを検索するか、現在のお気に入りを検索するかを指定します。
- ```tid```：どのパーティションを指定するかに使用され、すべてのパーティションが0になり、--ltidコマンドラインパラメータを使用すると、現在のお気に入りのすべての利用可能なtidを取得できます。
- ```order```：ソートする投稿動画のリストを指定します。```mtime```最近のお気に入り，```view```最も再生された動画，```pubtime```最新の投稿。
### チャンネル一覧
このプログラムは以下の入力をサポートしています(UID1を例にしています)：
- ```space.bilibili.com/1/channel/index```

UP主のすべてのチャンネルを解析して、ダウンロードするチャンネルを選択します。
### チャンネル
このプログラムは以下の入力をサポートしています(UID928123を例にしています)：
- ```space.bilibili.com/928123/channel/detail?cid=42271```
#### サポートしているGETパラメーター
- ```cid```：どのチャンネルかを示すために使用されます(パースするにはcidが必要です)
- ```order```：指明视频排序顺序，0为默认排序，1为倒序排序。

ダウンロードする必要があるものを選択するチャンネルのすべてのビデオを解析します。
### 投稿動画一覧
このプログラムは以下の入力をサポートしています(UID1を例にしています)：
- ```space.bilibili.com/1/video```
- ```bilibili.com/medialist/play/225910184```
#### サポートしているGETパラメーター
- ```tid```：用来指明视频类型，全部是0。可以使用```--ltid```命令行参数来获得当前UP主的投稿视频所有可用的tid。
- ```keyword```：投稿された動画のリストを検索するために使用される。
- ```order```： pubdateは最新のリリース、clickは最も再生された動画、stowは最もお気に入りの動画のリストの順番を指定します。

ダウンロードが必要なチャンネルのために、UP主が投稿した動画をすべて解析します。
### ライブ映像
このプログラムは以下の入力をサポートしています(R1mx411c7Enを例にしています)：
- ```live.bilibili.com/record/R1mx411c7En```
#### ビデオダウンロード
この時点ではオリジナルの画像のみがダウンロードに対応しているため、他の画質が表示された場合はダウンローダーが表示する必要があります
動画のリンク先を[issues](https://github.com/lifegpc/bili/issues)に投稿してください。
#### コメントダウンロード
現在は通常のコメントのみ対応しており、プレゼント(ギフト)などは対応していません
コメントは元の形式からXML形式に変換されます。
### ライブストリーミング
このプログラムは以下の入力をサポートしています(例として、部屋番号1)：
- ```live.bilibili.com/1```
#### ビデオダウンロード
複数の画質オプションをサポートしています
メインラインとバックアップラインの選択をサポートしています(コマンドラインが必要)。
### No. AUオーディオ
このプログラムは以下の入力をサポートしています(AU1を例にしています)：
- ```au1```
- ```bilibili.com/audio/au1```
- ```b23.tv/au1```
#### オーディオダウンロード
複数の音質に対応したので、使って楽しんでください
オーディオに通常のビデオが関連付けられている場合、関連するビデオページからより多くのオーディオ品質を取得するための試みが行われます。
#### 歌詞のみダウンロード
デフォルトでは、プログラムはダウンロードした歌詞ファイルをフィルタリングして、より多くのプレイヤーにフィットするようにそれらを修正します
オーディオに通常の動画が関連付けられている場合、関連する動画ページからより多くの歌詞(つまり字幕)を取得しようとします。
### プレイリスト
このプログラムは以下の入力をサポートしています（以AM29931432为例）：
- ```am29931432```
- ```bilibili.com/audio/am29931432```
- ```bilibili.com/audio/mycollection/29981833```
## 依存ライブラリ
[requests](https://pypi.org/project/requests/)   
[selenium](https://pypi.org/project/selenium/)  
[rsa](https://pypi.org/project/rsa/)  
[polib](https://pypi.org/project/polib/)  
[web.py](https://webpy.org/)  
[regex](https://pypi.org/project/regex/)  
[iso-639](https://pypi.org/project/iso-639/)  
[pywin32](https://pypi.org/project/pywin32/)  
ユーザー名・パスワードのログインセクションは、[Bilibili-Toolkit](https://github.com/Hsury/Bilibili-Toolkit)のログインセクションコードを参照しています。
### JavaScript依存ライブラリ
[jQuery](https://jquery.com/)  
[js-sha256](https://github.com/emn178/js-sha256)  
[jsbn](http://www-cs-students.stanford.edu/~tjw/jsbn/)（注意：[```webuihtml/js(origin)/rsa.js```](webuihtml/js(origin)/rsa.js)にマージされています）  
[js-base64](https://github.com/dankogai/js-base64)  
[QRCode.js](https://github.com/davidshimjs/qrcodejs)  
[Viewer.js](https://github.com/fengyuanchen/viewerjs)  
[clipboard.js](https://github.com/zenorocha/clipboard.js)  
[FileSaver.js](https://github.com/eligrey/FileSaver.js)
## ファイル構成
### cookies.json
このファイルは、BiliBiliにログインした後に取得したクッキー情報を保存し、プログラムがBiliBiliにログインした状態を維持するために使用します（コメント履歴インターフェースを呼び出すため、また、720p以上の動画をダウンロードするために）   

### settings.json
このファイルは、いくつかのデフォルトの操作の設定を保持しており、setettings.pyを実行することで設定を変更・確認することができます。

### webui.json
保存されたWEB UIの設定。

### sections.json
パスワード認証のためにWEBユーザーインターフェースを開いたときのセッション情報を保持します。

### tv.bilibili.player.xml
このファイルは必ずしも必要ではありません
主にポップアップのフィルタリングに使用します
PCのWebプレーヤーのコメントフィルタ設定からエクスポートしたファイルを直接プログラムディレクトリに入れて使用します
ファイル名がtv.bilibili.player.xmlになっていることを確認してください。

## はじめに
start.pyを直接実行する

### prepare.py
実行して、WEB UIの実行に必要なファイルの一部を取得します
ランタイムは、javaに直接アクセスできることを保証します。  
~~クラウドフレアのアンチボット検出が死んでいるため、自動で[这里](https://mvnrepository.com/artifact/com.google.javascript/closure-compiler/latest)更新したりダウンロードしたりすることができなくなっています~~（今のところアンチボットの検出はないようです）

### WEBユーザーインターフェース
startwebui.pyを実行した後、ブラウザでアクセスすることができます。  
デフォルトのアドレスは```http://localhost:8080```です。

### コメントのフィルタリング
filter.pyを実行してください
注意:コメントのフィルタリングを行うには、tv.bilibili.player.xmlファイルが必要です

## 翻訳
誰でも[Transifex](https://www.transifex.com/lifegpc/bili/)でこのプログラムの他言語の翻訳を提供することができます。  
日本語訳を提供してくれたKum4423氏に感謝。

## その他
一般の動画のコメントダウンロードを完璧にサポート
SS番号(番組)の通常のコメントと全コメントのダウンロードに対応しましたが、全コメントのダウンロード開始時間を手動で調整する必要があるかもしれません(各1Pのタイムスタンプはまだ見つかっていません)
全コメントのダウンロードは自動モードを使用することをお勧めします
注意:第1Pは概ね正確です

### 全コメントのダウンロード問題
BiliBiliではコメント履歴の呼び出し回数を制限しているため、12時間程度で1000回程度まで呼び出すことができますので、コメントが多くなった場合は時間間隔を大きく設定してください
制限された後、約12時間後に正常に戻ります

## FAQ

### リリースにおける各ドキュメントの違い
- ```bili_版本.7z``` 最简单的版本，需要自己下载/安装aria2c, chromedriver, ffmpeg, Python3.6+
- ```bili_版本_linux.7z``` 最简单的版本加上Linux版的chromedriver
- ```bili_版本_mac.7z``` 最简单的版本加上Mac版的chromedriver
- ```bili_版本_windows.7z``` 最简单的版本加上Windows版的chromedriver
- ```bili_版本_windows10_x64.7z``` 编译成exe的版本，可以直接在64位Windows10上运行。自带aria2c, chromedriver, ffmpeg
- ```bili_版本_windows10_x64.exe``` ```bili_版本_windows10_x64.7z```的安装包版本
- ```bili_版本_windows_x64.7z``` 自带Python3.8.6, aria2c, chromedriver, ffmpeg，双击bat文件即可直接在windows7及以上的64位系统中运行
- ```bili_版本_windows_x64.exe``` ```bili_版本_windows_x64.7z```的安装包版本
- ```bili_版本_windows_x86.7z``` 自带Python3.8.6, aria2c, chromedriver, ffmpeg，双击bat文件即可直接在windows7及以上的32位系统中运行
- ```bili_版本_windows_x86.exe``` ```bili_版本_windows_x86.7z```的安装包版本

最後の4つのバージョンを選ぶことをお勧めします。

### パスワードを入力できない
これは、パスワード入力時に画面上の入力の出力がオフ(表示が戻る)になっていることが原因です
解決方法は、普通にパスワードを入力してEnter Keyを押すだけです。

### 大会員のアカウントは、大会員しか見られないことを示唆している
まず、cookies.jsonを削除してからWEB UIではなくChromeDriverでログインします
(WEB UIのログインが現在バグっています)

### デフォルトのダウンロード場所はどこですか？
デフォルトのダウンロード場所は、プログラムが置かれているディレクトリ内の Downloadsフォルダです
インストーラを使用してインストールする場合、デフォルトのディレクトリは  
```%appdata%/bili```or```%appdata%/bili x86```or```%appdata%/bili x64```です。

### ffmpeg, aria2cを使用するべきかどうか
両方使うことをお勧めします
ffmpegは、分割された動画を自動的にマージするために使用されます
aria2cはダウンロード体験を大幅に向上させることができます

### 一括ダウンロードする方法
現在は、複数のパートを分割して使用したり、お気に入りなどを使用して一括ダウンロードすることができます
一括ダウンロードする場合はコマンドラインでの使用をお勧めします
(コマンドラインの基本はご自身で検索してください)

例えば、毎回メソッド4を利用してダウンロードする場合は、py start.py -d4とします
その他のコマンドラインコマンドは、py start.py -hを使用して確認することができます

### クラッシュした場合の対処方法
現在のところ、windows_x64とwindows_x86のバッチスクリプトを除いた他のすべてのバージョンは、実行後に直接終了します(プログラムにエラーがあるかどうかに関係なく)
メインのプログラムであれば、設定でファイルへのログの書き込みを有効にしてから、プログラムのあるディレクトリのログフォルダに移動してログを探します
エラーが発生した場合は、最後にエラーの正確なメッセージが表示されます

### aria2cのいくつかのダウンロード設定は何を意味しますか？
aria2c是一个多线程下载工具。  
多线程下载简单理解就是把1个文件分成n部分，每一部分同时下载。  
同时下载的部分数越多，一般速度也就越快。  
有关aria2c的设置：  
是否启用aria2c：建议是，使用aria2c可以提供更好的下载体验（下载速度快）  
使用aria2c时单个服务器最大连接数和单个文件最大连接数：这两者共同来限制最多能有多少部分能够同时下载。因此调大这两者可以增加同时下载的部分数，从而使速度加快。  
使用aria2c时文件分片大小：aria2c是根据文件分片大小来将1个文件分成n部分。假设有1个100M的文件，文件分片大小是20M，因此这个文件将会被分成5部分。当文件大小不足文件分片大小的2倍时，这个文件将不会被分成n部分，而是当作一个整体下载。调小这个可以时文件被分成的部分数加多，一定程度上可以加快速度。  
注：如果出现0b/s的情况，说明暂时被BiliBili CDN封禁，请适当调整上述参数以降低同时下载的部分数。  
在使用aria2c下载时使用备用网址：建议开着，这样可以同时从多个CDN服务器下载内容，加快下载速度。  
使用aria2c下载时文件预分配方式：这个一般建议保持默认值。  
在使用aria2c时最大总体速度(B/s)：这个根据个人需求设置吧。
